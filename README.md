# C. elegans 벌레 시뮬레이션 프로그램 설명서

## 프로그램 개요
이 프로그램은 C. elegans(예쁜꼬마선충) 벌레의 신경계를 시뮬레이션하는 2D 프로그램입니다. 실제 C. elegans의 302개 뉴런 연결망(Connectome)을 기반으로 벌레의 움직임, 먹이 탐색, 온도 감지 행동을 구현합니다.

## 주요 기능

### 1. 신경망 시뮬레이션
- **302개 뉴런 시각화**: C. elegans의 실제 신경망 구조를 재현
- **뉴런 활성화 표시**: 뉴런의 활성화 상태를 색상으로 표현
  - 🔴 빨간색: 높은 활성화 (FireThreshold 초과)
  - 🟢 초록색: 중간 활성화 (FireThreshold의 50% 초과)
  - 🔵 파란색: 낮은 활성화 (0 초과)
  - ⚫ 회색: 비활성화
- **근육 신경 제외**: MDL, MDR, MVL, MVR 근육 뉴런은 표시에서 제외

### 2. 하이브리드 AI 시스템
벌레의 행동은 두 가지 신호의 가중 평균으로 결정됩니다:
```
전체 AI = (1-k) × 뇌 신호 + k × 먹이 방향
```
- **k 값 (배고픔 수치)**:
  - 초기값: 0.5
  - 시간 경과: 초당 +0.01 증가
  - 먹이 섭취: -0.1 감소
  - 범위: 0.0 ~ 1.0
- k 값이 높을수록 먹이 탐색 행동이 우세해집니다

### 3. 먹이 시스템
- **먹이 감지 범위**: 200px
- **먹이 섭취 범위**: 20px
- **먹이 배치**: 일반 모드에서 마우스 클릭으로 먹이 생성
- **자동 추적**: 먹이가 감지 범위 내에 있으면 자동으로 방향 전환

### 4. 온도 시스템
#### 기본 설정
- **기본 온도**: 20°C
- **온도 범위**: -40°C ~ 80°C
- **선호 온도**: 프로그램 시작 시 8~25°C 범위에서 랜덤하게 결정

#### 온도 감지
- **AFD 뉴런**: AFDL, AFDR 뉴런이 온도 차이를 감지
- **온도 반응**:
  - 만족 (초록색): 온도 차이 5°C 이하
  - 중립 (회색): 온도 차이 5~15°C
  - 회피 (빨간색): 온도 차이 15°C 초과

#### 온도 맵 페인팅 (디버깅 모드)
- **브러쉬 모드**:
  - 🔥 **가열 모드** (A 키): 온도 상승
  - ❄️ **냉각 모드** (S 키): 온도 하강
  - 🗑️ **지우기 모드** (D 키): 온도 초기화
- **브러쉬 크기**: UP/DOWN 키로 조절 (20~150px)
- **온도 스케일**: LEFT/RIGHT 키로 조절 (±1~60°C)
- **페인팅 방법**: 마우스 드래그로 온도 맵 그리기
- **시각화**: 30×30px 그리드로 온도 표시
  - 🔵 파란색: 차가운 온도 (20°C 미만)
  - ⚪ 흰색: 기본 온도 (20°C)
  - 🔴 빨간색: 뜨거운 온도 (20°C 초과)
  - 온도 값을 정수로 표시

### 5. 모드 시스템
#### 일반 모드 (기본)
- 벌레의 움직임 관찰
- 마우스 클릭으로 먹이 배치
- 뉴런 시각화만 표시

#### 디버깅 모드
- **1/2 키**: 모드 전환
- **상세 정보 표시**:
  - 뉴런 정보 (뉴런 수, FireThreshold)
  - 배고픔 수치 (k 값)
  - 방향 벡터
  - 먹이 감지/섭취 범위
  - 현재 온도 및 선호 온도
  - 온도 차이 및 반응
  - 브러쉬 설정 (모드, 크기, 스케일)
  - 온도 포인트 수
- **온도 맵 페인팅 기능 활성화**

## 키보드 조작법

### 모드 전환
- **1 키**: 일반 모드로 전환
- **2 키**: 디버깅 모드로 전환

### 온도 설정 (디버깅 모드)
- **P 키**: 선호 온도 입력 모드
  - 숫자 입력 후 Enter로 확인
  - ESC로 취소
  - 유효 범위: 8~25°C
- **A 키**: 가열 브러쉬 모드
- **S 키**: 냉각 브러쉬 모드
- **D 키**: 지우기 브러쉬 모드
- **UP/DOWN 키**: 브러쉬 크기 조절
- **LEFT/RIGHT 키**: 온도 스케일 조절

### 마우스 조작
- **일반 모드**: 클릭으로 먹이 배치
- **디버깅 모드**: 드래그로 온도 맵 페인팅

## 화면 구성

### 왼쪽 영역 (900×900px)
- 벌레 시뮬레이션 공간
- 온도 맵 시각화 (디버깅 모드)
- 브러쉬 커서 표시 (디버깅 모드)

### 오른쪽 영역 (900×900px)
- **상단**: 디버깅 정보 (디버깅 모드)
- **하단**: 뉴런 시각화 (302개 뉴런)
  - 20개 행으로 배열
  - 각 뉴런의 이름과 활성화 상태 표시

## 기술적 세부사항

### 물리 엔진
- **회전**: 좌우 근육 신호 차이로 결정
- **속도**: 전후 근육 신호 합으로 결정
- **관성**: 속도 변화율로 부드러운 움직임 구현
- **몸체 표현**: 15개 세그먼트로 구성된 벌레 몸체

### 신경 신호 처리
1. 좌우 근육 신호 계산 (MDL, MVL vs MDR, MVR)
2. 회전 각도 및 이동 속도 결정
3. 먹이 탐색 신호와 k 값으로 가중 평균
4. 온도 차이에 따른 AFD 뉴런 자극
5. 벌레의 최종 움직임 계산

### 성능 최적화
- **게임 속도**: GAME_SPEED 상수로 시뮬레이션 속도 조절 가능
- **FPS 제한**: 60 FPS로 안정적 동작
- **선택적 렌더링**: 모드에 따라 필요한 UI만 표시

## 실행 요구사항
- Python 3.x
- Pygame
- brain.py (C. elegans 신경망 모듈)
- constants_default.py (신경망 연결 데이터)

## 실행 방법
```bash
python main.py
```

## 개발 및 실험 가이드

### 배고픔 실험
1. 디버깅 모드(2) 활성화
2. k 값 변화 관찰
3. 먹이 배치 후 행동 변화 확인

### 온도 선호도 실험
1. 디버깅 모드(2) 활성화
2. P 키로 선호 온도 설정
3. 브러쉬로 다양한 온도 구역 생성
4. 벌레의 이동 패턴 관찰
5. 온도 반응 (만족/중립/회피) 확인

### 신경망 분석
1. 디버깅 모드에서 뉴런 활성화 패턴 관찰
2. 특정 행동 시 어떤 뉴런이 활성화되는지 확인
3. FireThreshold 조절로 민감도 실험

## 참고사항
- 이 프로그램은 실제 C. elegans의 신경망 데이터를 기반으로 합니다
- 온도 감지는 AFD 뉴런의 실제 기능을 모델링한 것입니다
- 하이브리드 AI는 생물학적 신경망과 단순 행동 규칙의 조합입니다
